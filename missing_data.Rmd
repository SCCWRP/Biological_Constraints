---
output: html_document
---

```{r, warning = F, message = F, echo = F}
library(sf)
library(tidyverse)
library(mapview)
library(leaflet)
library(readxl)
source('R/funcs.R')

data(spat)
misdat <- read_excel('C:/Users/Marcus/Desktop/SGRRMP SCAPE Missing Sites 05.18.2019.xlsx')

prj <- '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs'

# color palette for stream expectations
pal_exp <- colorFactor(
  palette = RColorBrewer::brewer.pal(9, 'Paired')[c(2, 1, 5, 6)],
  na.color = 'yellow',
  levels = c('likely unconstrained', 'possibly unconstrained', 'possibly constrained', 'likely constrained'))

# expected comid classes
spat <- na.omit(spat)
cls <- getcls2(spat, thrsh = 0.79, tails = 0.1, modls = 'core')
dat_exp <- spat %>% 
  left_join(cls, by = 'COMID')

# missing data basemap
mp <- misdat %>% 
  rename(
    long = NominalLongitude, 
    lat = NominalLatitude
  ) %>% 
  mutate(
    long = as.numeric(long), 
    lat = as.numeric(lat)
  ) %>% 
  st_as_sf(coords = c('long', 'lat')) %>% 
  st_set_crs(prj) %>% 
  mapview(layer.name = 'reset') %>% 
  .@map

mp %>% 
  addPolylines(data = dat_exp, opacity = 1, weight = 1.25, color = ~pal_exp(strcls),
               label = ~paste0(COMID, ', Stream class:', strcls)
  )
      
```

